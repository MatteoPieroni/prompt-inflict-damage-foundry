!function(e){var a={};function t(n){if(a[n])return a[n].exports;var i=a[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var i in e)t.d(n,i,function(a){return e[a]}.bind(null,i));return n},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=1)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function processDamage({actorInstance:actorInstance,damage:damage,isHalved:isHalved,modifier:modifier}){const initialDamage=isHalved?Math.floor(damage/2):damage,trimmedModifier="string"==typeof modifier&&modifier.replaceAll(" ","");let modifiedDamage=initialDamage;if(trimmedModifier.length>0)try{if(!/^[\d+-]+$/g.test(trimmedModifier))throw new Error("The string has characters that are not allowed");modifiedDamage=eval(`${initialDamage} + ${trimmedModifier}`)}catch(e){return console.error(e),ui.notifications.error(game.i18n.localize("PID.FormulaError"))}const hasDamage=modifiedDamage>0,newCalculatedHp=actorInstance.data.data.attributes.hp.value-modifiedDamage>0?actorInstance.data.data.attributes.hp.value-modifiedDamage:0;return{damage:hasDamage?modifiedDamage:null,hp:newCalculatedHp}}__webpack_require__.d(__webpack_exports__,"a",(function(){return processDamage}))},function(e,a,t){"use strict";t.r(a);t.p;var n=t(0);function i(...e){0}function l(e){var a,t;const n=null==e||null===(a=e.actor)||void 0===a?void 0:a.id,i=null===(t=game)||void 0===t?void 0:t.users,l=null==i?void 0:i.get(game.userId);return!n||!l||(!l.isGM||!function(e){var a,t,n;const i=null===(a=game)||void 0===a?void 0:a.users,l=null===(t=game)||void 0===t||null===(n=t.actors)||void 0===n?void 0:n.get(e);if(!l)return!1;const r=Object.keys(l.data.permission).filter(e=>e!==game.userId&&"default"!==e).filter(e=>3===l.data.permission[e]);return 0!==r.length&&r.filter(e=>{var a;return null===(a=i.get(e))||void 0===a?void 0:a.active}).length>0}(n))}async function r({app:e={},data:a={}}){var t,r,o,d,u,c,s,m;let f=game.system.id;try{f=game.settings.get("prompt-inflict-damage","flagDomain")}catch(e){i()}const g=(null==e||null===(t=e.data)||void 0===t||null===(r=t.flags)||void 0===r||null===(o=r[f])||void 0===o||null===(d=o.roll)||void 0===d?void 0:d.type)||(null==e||null===(u=e.data)||void 0===u||null===(c=u.flags)||void 0===c||null===(s=c.dnd5e)||void 0===s||null===(m=s.roll)||void 0===m?void 0:m.type),v=e.user&&e.user.targets,p="damage"===g;if(i(),!p)return;if(0===v.length)return;const h=e._roll.total;v.forEach((function(e){!async function({total:e,target:a}){var t,i,r,o,d;const u=a.actor;if(!u.owner||!(null==u||null===(t=u.data)||void 0===t||null===(i=t.data)||void 0===i||null===(r=i.attributes)||void 0===r||null===(o=r.hp)||void 0===o?void 0:o.value)||!l(a))return;const c=null==u||null===(d=u.data)||void 0===d?void 0:d.name;let s={initialformula:"{{hp}} - "+e,name:c};const m=await renderTemplate("modules/prompt-inflict-damage/dist/dialog.html",s);new Promise(a=>{new Dialog({title:game.i18n.localize("PID.InflictDamageQuestion"),content:m,buttons:{inflict:{label:game.i18n.localize("PID.Inflict"),callback:async t=>{const i=t[0].querySelector("form").querySelector('[name="halved"]').checked,l=t[0].querySelector("form").querySelector('[name="modifier"]').value,{damage:r,hp:o}=Object(n.a)({actorInstance:u,damage:e,isHalved:i,modifier:l})||{};(r||o)&&(u.update({"data.attributes.hp.value":o}),r&&await ChatMessage.create({content:game.i18n.format("PID.DamageInflicted",{name:c,damage:r}),rollMode:"selfroll"}),a())}},cancel:{label:game.i18n.localize("PID.Cancel"),callback:()=>a(null)}},default:"inflict",close:()=>a(null)},{}).render(!0)})}({total:h,target:e})}))}let o=!1;Hooks.on("ready",()=>{o=!0,game.settings.register("prompt-inflict-damage","flagDomain",{name:game.i18n.localize("PID.SettingFlagName"),hint:game.i18n.localize("PID.SettingFlagNameHint"),scope:"world",config:!0,type:String,default:game.system.id})}),Hooks.on("renderChatMessage",(e,a,t)=>{o&&r({app:e,data:t})})}]);